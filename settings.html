<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/pallete.css">
    <link rel="stylesheet" href="style/containers.css">
    <link rel="stylesheet" href="style/inputs.css">
</head>

<body>
    <input type="text" id="list-title" class="title-box" hidden>
    <div id="list" class="todo-list" hidden></div>
    <div class="document">
        <a href="index.html"><span class="icon">arrow_back</span> Go back</a>
        <h1>Settings</h1>
        <h2>Look and feel</h2>
        <!-- color pallete -->
        <details name="setting">
            <summary>
                <span>Color pallete</span>
                <div>
                    <button class="text-button" onclick="savePallete()">Apply</button>
                    <button class="text-button" onclick="resetPalleteAndUpdate()">Reset</button>
                </div>
            </summary>
            <div class="center-flex">
                <input type="color" value="#242424" name="--background-color" id="--background-color">
                <label for="--background-color">Background color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#393939" name="--card-color" id="--card-color">
                <label for="--card-color">Card color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#464646" name="--field-color" id="--field-color">
                <label for="--field-color">Field color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#666666" name="--border-color" id="--border-color">
                <label for="--border-color">Border color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#cccccc" name="--text-color" id="--text-color">
                <label for="--text-color">Text color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#ffffff" name="--icon-color" id="--icon-color">
                <label for="--icon-color">Icon color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#ffffff" name="--title-color" id="--title-color">
                <label for="--title-color">Title color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#50d3ff" name="--highlight-color" id="--highlight-color">
                <label for="--highlight-color">Highlight color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#50ff99" name="--success-color" id="--success-color">
                <label for="--success-color">Create button color</label>
            </div>
            <div class="center-flex">
                <input type="color" value="#ff7474" name="--warning-color" id="--warning-color">
                <label for="--warning-color">Delete button color</label>
            </div>
        </details>
        <!-- wallpaper -->
        <details name="setting">
            <summary>
                <span>Wallpaper</span>
                <div>
                    <button class="text-button" onclick="resetWallpaper()">Reset</button>
                </div>
            </summary>
            <label for="--wallpaper">URL</label><br>
            <input type="url" name="--wallpaper" id="--wallpaper" oninput="saveWallpaper()"><br>
            <label for="--wallpaper-blur">Blur</label><br>
            <input type="range" name="--wallpaper-blur" id="--wallpaper-blur" min="0" max="10" value="0" oninput="saveWallpaper()">
        </details>

        <!-- fonts -->
        <details name="setting">
            <summary>
                <span>Font</span>
                <div>
                    <button class="text-button" onclick="resetFont()">Reset</button>
                </div>
            </summary>
            <label for="--font">Font</label>
            <input type="text" value="Segoe UI" name="--font" id="--font" oninput="saveFont()">
        </details>

        <hr>
        <h2>Data</h2>
        <details name="setting">
            <summary>My todo list</summary>
            <button class="text-button" onclick="exportTasks()">Export Markdown</button>
            <button class="text-button">
                <label for="import-file" style="cursor: pointer;">Import Markdown</label>
                <input type="file" id="import-file" style="display: none;" onchange="importTasks(event)">
            </button>
            <button class="danger-button" data-action="clearTasks()" title="Clear todo list [hold]">Clear</button>
        </details>

        <script src="script/settings.js"></script>
        <script src="script/todo.js"></script>
        <script src="script/dangerbuttons.js"></script>
        <script>
            function savePallete() {
                const colors = [
                    '--background-color',
                    '--card-color',
                    '--field-color',
                    '--border-color',
                    '--text-color',
                    '--icon-color',
                    '--title-color',
                    '--highlight-color',
                    '--success-color',
                    '--warning-color'
                ];

                colors.forEach(color => {
                    const input = document.getElementById(color);
                    if (input) {
                        saveItem(color, input.value);
                    }
                });

                const highlightColor = document.getElementById('--highlight-color').value;
                const successColor = document.getElementById('--success-color').value;
                const warningColor = document.getElementById('--warning-color').value;

                saveItem('--highlight-back', `${highlightColor}44`);
                saveItem('--success-back', `${successColor}44`);
                saveItem('--warning-back', `${warningColor}44`);
            }
            function loadPaletteIntoInputs() {
                const colors = [
                    '--background-color',
                    '--card-color',
                    '--field-color',
                    '--border-color',
                    '--text-color',
                    '--icon-color',
                    '--title-color',
                    '--highlight-color',
                    '--success-color',
                    '--warning-color'
                ];

                colors.forEach(color => {
                    const savedValue = loadItem(color);
                    const input = document.getElementById(color);
                    if (savedValue) {
                        input.value = savedValue;
                    }
                });
            }
            function resetPalleteAndUpdate() {
                resetPallete();
                loadPaletteIntoInputs();
            }
            loadPaletteIntoInputs();

            const fontInput = document.getElementById("--font");
            fontInput.value = loadItem('--font');

            function saveFont() {
                saveItem('--font', fontInput.value);
            }

            function resetFont() {
                removeItem('--font');
                fontInput.value = "";
            }

            const wallpaperInput = document.getElementById("--wallpaper");
            const wallpaperBlurInput = document.getElementById("--wallpaper-blur");
            
            let storedWallpaper = loadItem('--wallpaper');
            if (storedWallpaper?.startsWith("url('") && storedWallpaper.endsWith("')")) {
                storedWallpaper = storedWallpaper.slice(5, -2);
            }
            wallpaperInput.value = storedWallpaper || "";

            let storedWallpaperBlur = loadItem('--wallpaper-blur');
            if (storedWallpaperBlur?.endsWith("px")) {
                storedWallpaperBlur = storedWallpaperBlur.slice(0, -2);
            }
            wallpaperBlurInput.value = storedWallpaperBlur || 0;

            function saveWallpaper() {
                saveItem('--wallpaper', `url('${wallpaperInput.value}')`);
                saveItem('--wallpaper-blur', `${wallpaperBlurInput.value}px`)
            }

            function resetWallpaper() {
                removeItem('--wallpaper');
                removeItem('--wallpaper-blur');
                wallpaperInput.value = "";
            }

        </script>
    </div>
</body>

</html>